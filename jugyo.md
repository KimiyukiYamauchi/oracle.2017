# オラクル授業内容

### 各自のGitHubに演習提出用のリポジトリ作成
    - my.shを入1−れておく
    - メール「yamauchi @std.it-college.ac.jp」でURL通知

### I リレーショナルデータベースとSQL
- 表(テーブル), 行(row), 列(COLUMN)
- リレーショナル => 関連(表同士)
- NULL値 => フィールドに値が格納されていないこと。空白(スペース)、や数値の0とは区別される
- 主キー => 表内の行を一意に識別するための列
- 外部キー => 同じ表または他の表の主キー（または一意キー）を参照する列（または列の組みあせ)
- SQL
    - DML
        - SELECT, INSERT, UPDATE, DELETE, MERGE
    - DDL
        - CREATE, ALTER, DROP, RENAME, TRUNCATE, COMMENT
    - DCL
        - GRANT, REVOKE
    - トランザクション制御
        -COMMIT, ROLLBACK, SAVEPOINT

### 1 SELECT文を使用したデータの取得
- 射影 => 特定の列の取り出し
- 選択 => 特定の行の取り出し
- 結合 => 複数の表を関連付けてデータの取り出し
- SELECT => 取り出す列を指定、全列(*)
- FROM => 表を指定します
 - desc => 表の構造
 - SELECT句
    - 算術式
        - NULL値の扱い
    - 列別名
    - 結合演算子(||)
        - 代替引用符(q)演算子
    - 重複行の排除(distinct/unique)

### 2 データの制限及びソート
- SELECT => 取り出す列を指定、全列(*)
- FROM => 表を指定します
- WHERE => 行を選択する条件
- ORDER BY => 並べ替えのキー、昇順/降順
- OFFSET => スキップする行数
- FETCH => 返される行数/行の割合

### 3 単一行関数
- 関数
    - 単一行関数 => 各行に対する操作
    - 複数行関数(グループ関数) => 複数行をまとめて集計
- 文字関数
- 数値関数
    - 1 3 4 5 . 9 2 6
    -3 -2-1 0   1 2 3
- 日付関数
    - 日付 RR-MM-DD
    - 日付表示書式の変更  
    SQL> alter session set nls_date_format = 'DD-MON-RR';
    - 日付表示言語の変更  
    SQL> alter session set nls_date_language = 'AMERICAN';
    - 西暦の下2桁を表す方法
        - RR => 現在下二桁00 - 49
            - 99 => 1999(50 - 99 => 前の世紀)
            - 03 => 2003(00 - 49 => 現在の世紀)
            - => 現在の下二桁50 - 99
            - 99 => 1999(50 - 99 => 現在の世紀)
            - 03 => 2003(00 - 49 => 次の世紀)
        - YY => 上の2桁は現在の世紀 99 => 2099
    - ROUND
        - DD => 12時より前 => 現在の日、12以降 => 翌月
        - MONTH => 15日 => 今月、16日以降 => 翌月
        - YEAR => 6/30 => 今年、7/1以降 => 来年

### 4 変換関数
    - to_char => 文字列に変換(数値=>文字列,日付値=>文字列)
    - to_number => 数値に変換(文字列=>数値)
    - to_date => 日付値に変換(文字列=>日付値)
    - 暗黙的変換 => オラクルが自動で変換処理
    - 明示的変換 => 変換関数使って変換する
    - fm => 埋め込まれた空白を削除したり、先行の0を削除したりする  
    2回目のfmは機能の無効化
    - sp => 数字をスペル表記
    - th => 数字の接尾辞を追加
    - Month, MONTH, Dd, DD => March, MARCH, Ten , TEN

- 変換関数
- 汎用関数 => NVL, NVL2, NULLIF, COALESCE, CASE, DECODE

### 5 グループ関数

### 6 複数の表からのデータの取り出し
- SELECT => 取り出す列を指定、全列(*)
- FROM 表1 JOIN 表2
- ON 表結合の条件式

### 8 集合演算子の使用方法
- マージ、ソート
- UNION => 2つの問合せ結果を連結し、重複した行を排除  
、SELECT句の先頭の列で昇順にソート
- UNION ALL => 最初のselect文の結果に2番めのselect文の結果を  
追加している
- INTERSECT => 2つのと合わせ結果のうち、共通する行だけを戻す
- MINUS => 1つめの問合せけかのうち、2つ目の問合せ結果にない行を戻す
- 列の個数を同数にする
- データ型を同じ
- 列名は異なっていてもよい => 結果は1つ目の問合せのものが使用される
- 集合演算子(複合問合せ)ではNULL値は無視されません
- 集合演算子の優先順位はすべて同じ  
  => 前から順番に処理

### 9
#### データの追加
- INSERT INTO 表名 [(列名, ...)] 
- VALUES (値...)/(副問い合わせ);

#### データの更新
- UPDATE 表名
- SET 列名 = 値[, 列名 = 値 ...]/(副問い合わせ)
- [WHERE 条件];

#### データの削除
- DELETE [FROM] 表名
- [WHERE 列名 = 値/(副問い合わせ)];

#### トランザクション制御
- トランザクション => 一つまたは複数の操作によって完結する、一連のデータ操作をまとめた「論理的な処理単位」
- すべての操作を確定する(コミット) => commit;
- すべての操作を取り消す(ロールバック) => rollback;
- セーブポイントの作成と利用
    - 横浜 -> POINT A
    - savepoint a;
    - POINT A -> POINT B
    - savepoint b;
    - POINT B -> POINNT C
    - 全データを削除
    - rollback to b;
- 同時実行制御
    - 読取り一貫性 => DML操作開始時点での最新のコミット済データが、常に各セッションに戻されるように保証すること
    - ロック => ユーザがデータの変更処理(INSERT, UPDATE, DELETE)を実行すると、Oracleサーバは変更対象の行ごとに排他ロック(行レベルの排他なロック)をかけてからデータを変更します。
    - FOR UPDATE句による排他制御 => 更新前のSELECT文実行時に対象の行に  
    行レベルの排他ロックをかける